# 账户同步使用说明

## 新增功能概览
- **推送到服务器**：在“邮箱账户”页面点击“⬆️ 推送到服务器”，即可把当前的 `accounts.json` 内容备份到服务器数据库。
- **拉取到本地**：点击“⬇️ 拉取到本地”，把服务器侧的备份恢复到本地 `accounts.json`。

## 使用步骤
1. 登录管理界面，进入“邮箱账户”页。
2. 需要备份时，点击“推送到服务器”，等待提示出现“推送完成”。
3. 需要恢复时，点击“拉取到本地”，根据提示确认“拉取完成”。
4. 按钮旁会显示实时提示，方便确认操作结果。

## 冲突处理策略
- 默认优先保留本地 `accounts.json` 内容。
- 如果希望优先采用服务器数据，可在部署环境里把变量 `ACCOUNTS_SYNC_CONFLICT` 设置为 `prefer_remote` 后重启服务。

## 数据库连接准备
在部署环境中设置以下变量，并确保服务重启后生效：

| 变量名 | 用途 |
| --- | --- |
| `ACCOUNTS_DB_HOST` | 数据库地址（例如内网 IP 或域名） |
| `ACCOUNTS_DB_PORT` | 数据库端口，默认 3306 |
| `ACCOUNTS_DB_USER` | 用于读写备份表的账户 |
| `ACCOUNTS_DB_PASSWORD` | 上述账户的密码 |
| `ACCOUNTS_DB_NAME` | 存储备份数据的数据库名称 |
| `ACCOUNTS_DB_TABLE` | 备份表名称，默认 `account_backups` |

以上信息配置完整后，系统会自动建表并开始备份。

## 常见提示
- “同步未配置”：说明数据库连接信息还未就绪，请联系运维补齐环境变量后再操作。
- “同步到服务器失败”或“从服务器同步失败”：通常是数据库暂时不可用，稍后重试即可；如多次失败，请反馈给运维排查。
