<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Outlook邮件管理系统</title>
    <link rel="stylesheet" href="/static/css/base.css">
    <link rel="stylesheet" href="/static/css/forms.css">
    <link rel="stylesheet" href="/static/css/components.css">
    <link rel="stylesheet" href="/static/css/responsive.css">
</head>
<body>
    <div class="app-container">
        <!-- 左侧菜单 -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h1>📧 邮件管理</h1>
                <p>Outlook邮件管理系统</p>
            </div>
            <nav class="sidebar-nav">
                <button class="nav-item active" onclick="showPage('accounts', this)">
                    <span class="icon">👥</span>
                    邮箱账户
                </button>
                <button class="nav-item" onclick="showPage('addAccount', this)">
                    <span class="icon">➕</span>
                    添加账户
                </button>
                <button class="nav-item" onclick="showPage('batchAdd', this)">
                    <span class="icon">📦</span>
                    批量添加
                </button>
                <button class="nav-item" onclick="showPage('apiDocs', this)">
                    <span class="icon">📖</span>
                    API管理
                </button>
                <button class="nav-item" onclick="showPage('settings', this)">
                    <span class="icon">⚙️</span>
                    安全设置
                </button>
                <button class="nav-item" onclick="showPage('emails', this)" oncontextmenu="showEmailsContextMenu(event)" id="emailsNav" style="display: none;">
                    <span class="icon">📧</span>
                    邮件列表
                </button>
            </nav>
        </div>

        <!-- 主内容区域 -->
        <div class="main-content">
            <div class="main-header">
                <h2 id="pageTitle">邮箱账户管理</h2>
                <div id="headerActions"></div>
            </div>

            <div class="main-body">
                <!-- 邮箱账户列表页面 -->
                <div id="accountsPage" class="page">
                    <div class="card">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <h3 class="font-semibold">邮箱账户管理</h3>
                                <p class="text-sm" style="color: #64748b;">管理所有已添加的邮箱账户</p>
                            </div>
                            <div class="flex gap-2">
                                <button class="btn btn-primary btn-sm" onclick="showPage('addAccount')">
                                    <span>➕</span>
                                    添加账户
                                </button>
                                <button class="btn btn-secondary btn-sm" onclick="showPage('batchAdd')">
                                    <span>📦</span>
                                    批量添加
                                </button>
                                <button class="btn btn-secondary btn-sm" id="syncToServerBtn" onclick="syncAccountsToServer(this)">
                                    <span>⬆️</span>
                                    推送到服务器
                                </button>
                                <button class="btn btn-secondary btn-sm" id="syncFromServerBtn" onclick="syncAccountsFromServer(this)">
                                    <span>⬇️</span>
                                    拉取到本地
                                </button>
                                <button class="btn btn-secondary btn-sm" onclick="loadAccounts()">
                                    <span>🔄</span>
                                    刷新列表
                                </button>
                            </div>
                        </div>
                        
                        <!-- 搜索和过滤区域 -->
                        <div class="search-container">
                            <div class="flex gap-3 mb-4">
                                <div class="flex-1">
                                    <input type="text" id="accountEmailSearch" class="form-control" placeholder="按邮箱账号搜索..." onkeypress="handleSearchKeyPress(event)">
                                </div>
                                <div class="flex-1">
                                    <input type="text" id="tagSearch" class="form-control" placeholder="按标签搜索..." onkeypress="handleSearchKeyPress(event)">
                                </div>
                                <button class="btn btn-primary" onclick="searchAccounts()">
                                    <span>🔍</span>
                                    搜索
                                </button>
                                <button class="btn btn-secondary" onclick="clearSearch()">
                                    <span>🗑️</span>
                                    清除
                                </button>
                            </div>
                        </div>
                        
                        <!-- 统计信息 -->
                        <div id="accountsStats" class="mb-4" style="display: none;">
                            <div class="flex gap-4 text-sm">
                                <span>总数：<strong id="totalAccounts">0</strong></span>
                                <span>当前页：<strong id="currentPage">1</strong></span>
                                <span>每页：<strong id="pageSize">10</strong></span>
                            </div>
                        </div>

                        <div id="accountsList" class="account-list">
                            <div class="loading">
                                <div class="loading-spinner"></div>
                                正在加载账户列表...
                            </div>
                        </div>
                        
                        <!-- 分页控件 -->
                        <div id="accountsPagination" class="pagination" style="display: none;">
                            <button class="btn btn-sm" id="prevPageBtn" onclick="changePage('prev')" disabled>
                                <span>←</span>
                                上一页
                            </button>
                            <div id="pageNumbers" class="flex gap-1"></div>
                            <button class="btn btn-sm" id="nextPageBtn" onclick="changePage('next')">
                                下一页
                                <span>→</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 添加单个账户页面 -->
                <div id="addAccountPage" class="page hidden">
                    <div class="card">
                        <div class="flex items-center justify-between mb-6">
                            <div>
                                <h3 class="font-semibold">添加邮箱账户</h3>
                                <p class="text-sm" style="color: #64748b;">添加单个Outlook邮箱账户到系统</p>
                            </div>
                            <button class="btn btn-secondary btn-sm" onclick="showPage('accounts')">
                                <span>←</span>
                                返回列表
                            </button>
                        </div>

                        <div style="max-width: 600px;">
                            <div class="form-group">
                                <label class="form-label">邮箱地址 *</label>
                                <input type="email" id="email" class="form-input" placeholder="example@outlook.com" required>
                                <p class="text-xs" style="color: #64748b; margin-top: 4px;">请输入有效的Outlook邮箱地址</p>
                            </div>

                            <div class="form-group">
                                <label class="form-label">刷新令牌 (Refresh Token) *</label>
                                <textarea id="refreshToken" class="form-input form-textarea" rows="4" placeholder="从Azure应用获取的refresh_token" required></textarea>
                                <p class="text-xs" style="color: #64748b; margin-top: 4px;">
                                    从Azure应用程序注册中获取的刷新令牌，用于OAuth2认证
                                </p>
                            </div>

                            <div class="form-group">
                                <label class="form-label">客户端ID (Client ID) *</label>
                                <input type="text" id="clientId" class="form-input" placeholder="Azure应用的client_id" required>
                                <p class="text-xs" style="color: #64748b; margin-top: 4px;">
                                    Azure应用程序的客户端标识符
                                </p>
                            </div>

                            <div class="form-group">
                                <div style="background: #f8fafc; padding: 16px; border-radius: 8px; border: 1px solid #e2e8f0;">
                                    <h4 style="margin: 0 0 8px 0; font-size: 0.875rem; font-weight: 600; color: #374151;">📋 获取步骤：</h4>
                                    <ol style="margin: 0; padding-left: 20px; font-size: 0.75rem; color: #6b7280; line-height: 1.5;">
                                        <li>访问 <a href="https://portal.azure.com" target="_blank" style="color: #3b82f6;">Azure Portal</a></li>
                                        <li>注册应用程序并配置权限</li>
                                        <li>获取Client ID和Refresh Token</li>
                                        <li>确保应用有邮件读取权限</li>
                                    </ol>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="accountTags">标签 (可选，用逗号分隔)</label>
                                <input type="text" id="accountTags" class="form-control" placeholder="工作,个人,重要">
                            </div>

                            <div class="flex gap-3">
                                <button class="btn btn-primary" onclick="addAccount()" id="addAccountBtn">
                                    <span>➕</span>
                                    添加账户
                                </button>
                                <button class="btn btn-secondary" onclick="clearAddAccountForm()">
                                    <span>🗑️</span>
                                    清空表单
                                </button></div>
                        </div>
                    </div>
                </div>

                <!-- 批量添加账户页面 -->
                <div id="batchAddPage" class="page hidden">
                    <div class="card">
                        <div class="flex items-center justify-between mb-6">
                            <div>
                                <h3 class="font-semibold">批量添加邮箱账户</h3>
                                <p class="text-sm" style="color: #64748b;">一次性添加多个邮箱账户到系统</p>
                            </div>
                            <button class="btn btn-secondary btn-sm" onclick="showPage('accounts')">
                                <span>←</span>
                                返回列表
                            </button>
                        </div>

                        <div style="max-width: 800px;">
                            <div class="form-group">
                                <label class="form-label">批量账户信息</label>
                                <p class="text-sm" style="color: #64748b; margin-bottom: 8px;">
                                    每行格式：<code>邮箱----密码----刷新令牌----客户端ID</code>
                                </p>
                                <p class="text-sm" style="color: #64748b; margin-bottom: 12px;">
                                    📧 推荐购买地址（非广告，只是推荐）：
                                    <a target="_blank" href="http://wmemail.com" style="color: #3b82f6; margin: 0 8px;">wmemail.com</a>
                                </p>
                                <textarea id="batchAccounts" class="form-input form-textarea" rows="12" placeholder="example1@outlook.com----password1----refresh_token1----client_id1
example2@outlook.com----password2----refresh_token2----client_id2
example3@outlook.com----password3----refresh_token3----client_id3"></textarea>
                                <p class="text-xs" style="color: #64748b; margin-top: 8px;">
                                    💡 提示：每行一个账户，使用四个连字符(----)分隔字段
                                </p>
                            </div>

                            <div class="form-group">
                                <div style="background: #fef3c7; padding: 16px; border-radius: 8px; border: 1px solid #fbbf24;">
                                    <h4 style="margin: 0 0 8px 0; font-size: 0.875rem; font-weight: 600; color: #92400e;">⚠️ 注意事项：</h4>
                                    <ul style="margin: 0; padding-left: 20px; font-size: 0.75rem; color: #92400e; line-height: 1.5;">
                                        <li>确保所有账户信息格式正确</li>
                                        <li>建议先测试少量账户再批量添加</li>
                                        <li>添加过程中请勿关闭页面</li>
                                        <li>失败的账户会在结果中显示</li>
                                    </ul>
                                </div>
                            </div>

                            <div class="flex gap-3">
                                <button class="btn btn-primary" onclick="batchAddAccounts()" id="batchAddBtn">
                                    <span>📦</span>
                                    开始批量添加
                                </button>
                                <button class="btn btn-secondary" onclick="clearBatchForm()">
                                    <span>🗑️</span>
                                    清空表单
                                </button>
                                <button class="btn btn-secondary" onclick="validateBatchFormat()">
                                    <span>✅</span>
                                    验证格式
                                </button></div>

                            <!-- 批量添加进度 -->
                            <div id="batchProgress" class="hidden" style="margin-top: 24px;">
                                <h4 style="margin-bottom: 12px; font-size: 0.875rem; font-weight: 600;">添加进度：</h4>
                                <div class="progress-bar">
                                    <div class="progress-fill" id="batchProgressFill"></div>
                                </div>
                                <div style="display: flex; justify-content: space-between; font-size: 0.75rem; color: #64748b; margin-top: 8px;">
                                    <span id="batchProgressText">准备中...</span>
                                    <span id="batchProgressCount">0 / 0</span>
                                </div>
                            </div>

                            <!-- 批量添加结果 -->
                            <div id="batchResults" class="hidden" style="margin-top: 24px;">
                                <h4 style="margin-bottom: 12px; font-size: 0.875rem; font-weight: 600;">添加结果：</h4>
                                <div id="batchResultsList"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- API文档页面 -->
                <div id="apiDocsPage" class="page hidden">
                    <div class="card">
                        <div class="flex items-center justify-between mb-6">
                            <div>
                                <h3 class="font-semibold">API接口文档</h3>
                                <p class="text-sm" style="color: #64748b;">邮件管理系统的RESTful API接口说明</p>
                            </div>
                            <div class="flex gap-2">
                                <button class="btn btn-secondary btn-sm" onclick="copyApiBaseUrl()">
                                    <span>📋</span>
                                    复制Base URL
                                </button>
                                <button class="btn btn-secondary btn-sm" onclick="downloadApiDocs()">
                                    <span>📥</span>
                                    下载文档
                                </button>
                            </div>
                        </div>

                        <div class="api-docs">
                            <!-- API基础信息 -->
                            <div class="api-endpoint">
                                <div class="api-header">
                                    <div>
                                        <h3 style="margin: 0; color: #1f2937;">📡 API基础信息</h3>
                                    </div>
                                </div>
                                <div class="api-body">
                                    <div class="api-section">
                                        <h4>Base URL</h4>
                                        <div class="api-example" id="baseUrlExample">http://localhost:8001</div>
                                    </div>
                                    <div class="api-section">
                                        <h4>认证方式</h4>
                                        <p class="api-description">登录后使用服务器返回的会话 Cookie，并在请求头中附加 <code>Authorization: Key &lt;API_KEY&gt;</code>。</p>
                                    </div>
                                    <div class="api-section">
                                        <h4>响应格式</h4>
                                        <p class="api-description">所有接口返回JSON格式数据，HTTP状态码表示请求结果。</p>
                                    </div>
                                </div>
                            </div>

                            <!-- 获取邮箱列表接口 -->
                            <div class="api-endpoint">
                                <div class="api-header">
                                    <div style="display: flex; align-items: center;">
                                        <span class="api-method get">GET</span>
                                        <span class="api-path">/accounts</span>
                                    </div>
                                    <button class="api-try-button" onclick="tryApi('accounts')">🚀 试用接口</button>
                                </div>
                                <div class="api-body">
                                    <p class="api-description">获取系统中所有已添加的邮箱账户列表，支持分页和模糊搜索。</p>

                                    <div class="api-section">
                                        <h4>请求参数</h4>
                                        <div class="api-params">
                                            <div class="api-param">
                                                <span class="api-param-name">page</span>
                                                <span class="api-param-type">integer</span>
                                                <span class="api-param-desc">页码，从1开始，默认: 1</span>
                                            </div>
                                            <div class="api-param">
                                                <span class="api-param-name">page_size</span>
                                                <span class="api-param-type">integer</span>
                                                <span class="api-param-desc">每页数量，范围1-100，默认: 10</span>
                                            </div>
                                            <div class="api-param">
                                                <span class="api-param-name">email_search</span>
                                                <span class="api-param-type">string</span>
                                                <span class="api-param-desc">邮箱账号模糊搜索，可选</span>
                                            </div>
                                            <div class="api-param">
                                                <span class="api-param-name">tag_search</span>
                                                <span class="api-param-type">string</span>
                                                <span class="api-param-desc">标签模糊搜索，可选</span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="api-section">
                                        <h4>响应示例</h4>
                                        <div class="api-example">{
  "total_accounts": 25,
  "page": 1,
  "page_size": 10,
  "total_pages": 3,
  "accounts": [
    {
      "email_id": "example@outlook.com",
      "client_id": "your-client-id",
      "status": "active",
      "tags": ["工作", "个人"]
    }
  ]
}</div>
                                    </div>

                                    <div class="api-response" id="accountsResponse">
                                        <h4 style="margin-bottom: 8px; color: #15803d;">响应结果：</h4>
                                        <pre id="accountsResponseData"></pre>
                                    </div>
                                </div>
                            </div>

                            <!-- 获取邮件列表接口 -->
                            <div class="api-endpoint">
                                <div class="api-header">
                                    <div style="display: flex; align-items: center;">
                                        <span class="api-method get">GET</span>
                                        <span class="api-path">/emails/{email_id}</span>
                                    </div>
                                    <button class="api-try-button" onclick="tryApi('emails')">🚀 试用接口</button>
                                </div>
                                <div class="api-body">
                                    <p class="api-description">获取指定邮箱的邮件列表，支持分页和过滤。</p>

                                    <div class="api-section">
                                        <h4>路径参数</h4>
                                        <div class="api-params">
                                            <div class="api-param">
                                                <span class="api-param-name">email_id</span>
                                                <span class="api-param-type">string</span>
                                                <span class="api-param-desc">邮箱地址，需要URL编码</span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="api-section">
                                        <h4>查询参数</h4>
                                        <div class="api-params">
                                            <div class="api-param">
                                                <span class="api-param-name">folder</span>
                                                <span class="api-param-type">string</span>
                                                <span class="api-param-desc">邮件文件夹 (all, inbox, junk)，默认: all</span>
                                            </div>
                                            <div class="api-param">
                                                <span class="api-param-name">page</span>
                                                <span class="api-param-type">integer</span>
                                                <span class="api-param-desc">页码，从1开始，默认: 1</span>
                                            </div>
                                            <div class="api-param">
                                                <span class="api-param-name">page_size</span>
                                                <span class="api-param-type">integer</span>
                                                <span class="api-param-desc">每页数量，范围1-500，默认: 100</span>
                                            </div>
                                            <div class="api-param">
                                                <span class="api-param-name">refresh</span>
                                                <span class="api-param-type">boolean</span>
                                                <span class="api-param-desc">是否强制刷新缓存，默认: false</span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="api-section">
                                        <h4>请求示例</h4>
                                        <div class="api-example">GET /emails/example%40outlook.com?folder=inbox&page=1&page_size=20&refresh=true</div>
                                    </div>

                                    <div class="api-section">
                                        <h4>响应示例</h4>
                                        <div class="api-example">{
  "email_id": "example@outlook.com",
  "folder_view": "inbox",
  "page": 1,
  "page_size": 20,
  "total_emails": 150,
  "emails": [
    {
      "message_id": "INBOX-1",
      "folder": "INBOX",
      "subject": "邮件主题",
      "from_email": "sender@example.com",
      "date": "2024-01-01T12:00:00Z",
      "is_read": false,
      "has_attachments": true,
      "sender_initial": "S"
    }
  ]
}</div>
                                    </div>

                                    <div class="api-response" id="emailsResponse">
                                        <h4 style="margin-bottom: 8px; color: #15803d;">响应结果：</h4>
                                        <pre id="emailsResponseData"></pre>
                                    </div>
                                </div>
                            </div>

                            <!-- 获取邮件详情接口 -->
                            <div class="api-endpoint">
                                <div class="api-header">
                                    <div style="display: flex; align-items: center;">
                                        <span class="api-method get">GET</span>
                                        <span class="api-path">/emails/{email_id}/{message_id}</span>
                                    </div>
                                    <button class="api-try-button" onclick="tryApi('emailDetail')">🚀 试用接口</button>
                                </div>
                                <div class="api-body">
                                    <p class="api-description">获取指定邮件的详细内容，包括邮件正文。</p>

                                    <div class="api-section">
                                        <h4>路径参数</h4>
                                        <div class="api-params">
                                            <div class="api-param">
                                                <span class="api-param-name">email_id</span>
                                                <span class="api-param-type">string</span>
                                                <span class="api-param-desc">邮箱地址，需要URL编码</span>
                                            </div>
                                            <div class="api-param">
                                                <span class="api-param-name">message_id</span>
                                                <span class="api-param-type">string</span>
                                                <span class="api-param-desc">邮件ID，格式: {folder}-{id}</span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="api-section">
                                        <h4>请求示例</h4>
                                        <div class="api-example">GET /emails/example%40outlook.com/INBOX-1</div>
                                    </div>

                                    <div class="api-section">
                                        <h4>响应示例</h4>
                                        <div class="api-example">{
  "message_id": "INBOX-1",
  "subject": "邮件主题",
  "from_email": "sender@example.com",
  "to_email": "example@outlook.com",
  "date": "2024-01-01T12:00:00Z",
  "body_plain": "纯文本邮件内容",
  "body_html": "&lt;html&gt;&lt;body&gt;HTML邮件内容&lt;/body&gt;&lt;/html&gt;"
}</div>
                                    </div>

                                    <div class="api-response" id="emailDetailResponse">
                                        <h4 style="margin-bottom: 8px; color: #15803d;">响应结果：</h4>
                                        <pre id="emailDetailResponseData"></pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 安全设置页面 -->
                <div id="settingsPage" class="page hidden">
                    <div class="card" style="max-width: 720px;">
                        <div class="flex items-center justify-between mb-6">
                            <div>
                                <h3 class="font-semibold">安全设置</h3>
                                <p class="text-sm" style="color: #64748b;">管理登录会话与 API Key</p>
                            </div>
                            <button class="btn btn-secondary btn-sm" onclick="refreshSecurityInfo()">
                                <span>🔄</span>
                                刷新状态
                            </button>
                        </div>

                        <div class="form-group">
                            <label class="form-label">当前 API Key</label>
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <input id="apiKeyDisplay" class="form-input" type="text" readonly value="未设置" style="flex: 1;">
                                <button id="copyApiKeyBtn" class="btn btn-secondary btn-sm" onclick="copyApiKey()" disabled>
                                    <span>📋</span>
                                    复制
                                </button>
                            </div>
                            <div class="flex gap-2" style="margin-top: 12px;">
                                <button class="btn btn-primary" onclick="generateApiKey()">
                                    <span>🔐</span>
                                    生成随机 Key
                                </button>
                                <button class="btn btn-danger" onclick="deleteApiKey()">
                                    <span>🗑️</span>
                                    删除 Key
                                </button>
                            </div>
                            <p class="text-sm" style="color: #64748b; margin-top: 8px;">
                                登录后须先设置 Key 才能调用业务接口。删除后需重新设置。
                            </p>
                        </div>

                        <div class="form-group">
                            <label class="form-label">自定义 Key</label>
                            <input id="customApiKeyInput" class="form-input" type="text" placeholder="输入自定义 Key（建议至少32位随机字符）">
                            <button class="btn btn-secondary" style="margin-top: 12px;" onclick="saveCustomApiKey()">
                                <span>💾</span>
                                保存自定义 Key
                            </button>
                        </div>

                        <div class="card" style="background: #f8fafc; border-color: #e2e8f0; margin-top: 24px;">
                            <h4 style="margin-bottom: 12px; color: #1e293b;">安全统计</h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
                                <div style="background: #ffffff; border: 1px solid #e2e8f0; border-radius: 8px; padding: 16px;">
                                    <div style="font-size: 0.75rem; color: #64748b;">密码错误次数</div>
                                    <div style="font-size: 1.5rem; font-weight: 600; color: #1e293b; margin-top: 8px;" id="passwordFailCount">0</div>
                                </div>
                                <div style="background: #ffffff; border: 1px solid #e2e8f0; border-radius: 8px; padding: 16px;">
                                    <div style="font-size: 0.75rem; color: #64748b;">API Key 错误次数</div>
                                    <div style="font-size: 1.5rem; font-weight: 600; color: #1e293b; margin-top: 8px;" id="apiKeyFailCount">0</div>
                                </div>
                            </div>
                            <div style="margin-top: 16px;">
                                <h5 style="font-size: 0.875rem; color: #475569; margin-bottom: 8px;">被锁定的 IP</h5>
                                <div style="font-size: 0.8125rem; color: #64748b;">
                                    <p>登录锁定：<span id="loginLockedIps">无</span></p>
                                    <p>API Key 锁定：<span id="keyLockedIps">无</span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 邮件列表页面 -->
                <div id="emailsPage" class="page hidden">
                    <div class="card">
                        <!-- 账户信息和操作按钮 -->
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <h3 class="font-semibold">当前账户：
                                    <span id="currentAccountEmail"
                                          class="text-sm font-medium email-copyable"
                                          style="color: #3b82f6; cursor: pointer; position: relative;"
                                          onclick="copyEmailAddress(this.textContent)"
                                          title="点击复制邮箱地址">
                                    </span>
                                    <span class="copy-icon" style="margin-left: 6px; opacity: 0.6; font-size: 0.8em;">📋</span>
                                </h3>
                                <p class="text-sm" style="color: #64748b;">最后更新：<span id="lastUpdateTime">-</span></p>
                            </div>
                            <div class="flex gap-2">
                                <button class="btn btn-secondary btn-sm" onclick="refreshEmails()" id="refreshBtn">
                                    <span>🔄</span>
                                    刷新
                                </button>
                                <button class="btn btn-secondary btn-sm" onclick="clearCache()">
                                    <span>🗑️</span>
                                    清除缓存
                                </button>
                                <button class="btn btn-secondary btn-sm" onclick="exportEmails()">
                                    <span>📤</span>
                                    导出
                                </button>
                                <button class="btn btn-secondary btn-sm" onclick="backToAccounts()">
                                    <span>←</span>
                                    返回账户
                                </button>
                            </div>
                        </div>

                        <!-- 统计信息 -->
                        <div class="stats-container">
                            <div class="stat-item">
                                <div class="stat-value" id="totalEmailCount">0</div>
                                <div class="stat-label">总邮件数</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="unreadEmailCount">0</div>
                                <div class="stat-label">未读邮件</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="todayEmailCount">0</div>
                                <div class="stat-label">今日邮件</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="attachmentEmailCount">0</div>
                                <div class="stat-label">带附件</div>
                            </div>
                        </div>

                        <!-- 搜索和过滤 -->
                        <div class="search-container">
                            <span class="search-icon">🔍</span>
                            <input type="text" class="search-input" id="emailSearchInput" placeholder="搜索邮件标题、发件人或内容..." onkeyup="searchEmails()">
                        </div>

                        <div class="filter-container">
                            <div class="filter-group">
                                <label class="filter-label">文件夹:</label>
                                <select class="filter-select" id="folderFilter" onchange="applyFilters()">
                                    <option value="all">全部邮件</option>
                                    <option value="inbox">收件箱</option>
                                    <option value="junk">垃圾邮件</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label class="filter-label">状态:</label>
                                <select class="filter-select" id="statusFilter" onchange="applyFilters()">
                                    <option value="all">全部状态</option>
                                    <option value="unread">未读</option>
                                    <option value="read">已读</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label class="filter-label">时间:</label>
                                <select class="filter-select" id="timeFilter" onchange="applyFilters()">
                                    <option value="all">全部时间</option>
                                    <option value="today">今天</option>
                                    <option value="week">本周</option>
                                    <option value="month">本月</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label class="filter-label">附件:</label>
                                <select class="filter-select" id="attachmentFilter" onchange="applyFilters()">
                                    <option value="all">全部</option>
                                    <option value="with">有附件</option>
                                    <option value="without">无附件</option>
                                </select>
                            </div>
                            <button class="btn btn-secondary btn-sm" onclick="clearFilters()">
                                <span>🗑️</span>
                                清除筛选
                            </button>
                        </div>

                        <!-- 邮件列表 -->
                        <div id="emailsList" class="email-list">
                            <div class="loading">
                                <div class="loading-spinner"></div>
                                正在加载邮件...
                            </div>
                        </div>

                        <div id="emailsPagination" class="pagination hidden"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 通知容器 -->
    <div id="notificationContainer" class="notification-container"></div>

    <!-- 邮件详情模态框 -->
    <div id="emailModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="emailModalTitle">邮件详情</h3>
                <button class="modal-close" onclick="closeEmailModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="emailModalContent">
                    <div class="loading">正在加载邮件详情...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- 标签管理模态框 -->
    <div id="tagsModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3>管理账户标签</h3>
                <span class="close" onclick="closeTagsModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="currentTags">当前标签</label>
                    <div id="currentTagsList" class="tags-list"></div>
                </div>
                <div class="form-group">
                    <label for="newTag">添加新标签</label>
                    <div class="input-group">
                        <input type="text" id="newTag" class="form-control" placeholder="输入标签名称">
                        <button class="btn btn-primary" onclick="addTag()">添加</button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeTagsModal()">取消</button>
                <button class="btn btn-primary" onclick="saveAccountTags()">保存</button>
            </div>
        </div>
    </div>

    <!-- 备注编辑模态框 -->
    <div id="noteModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 520px;">
            <div class="modal-header">
                <h3>编辑账户备注</h3>
                <button class="modal-close" onclick="closeNoteModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="noteTextarea" class="form-label">备注信息</label>
                    <textarea id="noteTextarea" class="form-input form-textarea" rows="6" placeholder="输入备注内容，支持多行"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeNoteModal()">取消</button>
                <button class="btn btn-primary" onclick="saveAccountNote()">保存</button>
            </div>
        </div>
    </div>

    <!-- 右键菜单 -->
    <div id="contextMenu" class="context-menu">
        <div class="context-menu-item" onclick="openInNewTab()">
            <span>🔗</span>
            在新标签页中打开
        </div>
        <div class="context-menu-item" onclick="copyAccountLink()">
            <span>📋</span>
            复制链接
        </div>
        <div class="context-menu-divider"></div>
        <div class="context-menu-item" onclick="contextEditTags()">
            <span>🏷️</span>
            管理标签
        </div>
        <div class="context-menu-item danger" onclick="contextDeleteAccount()">
            <span>🗑️</span>
            删除账户
        </div>
    </div>

    <script src="/static/js/common.js" defer></script>
    <script src="/static/js/security.js" defer></script>
    <script src="/static/js/accounts.js" defer></script>
    <script src="/static/js/emails.js" defer></script>
    <script src="/static/js/app.js" defer></script>
</body>
</html>